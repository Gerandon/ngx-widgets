<mat-form-field [appearance]="appearance() ?? _appearance()"
                [color]="color() ?? _color()"
                [subscriptSizing]="subscriptSizing()"
                [hintLabel]="_hintLabel"
                [floatLabel]="floatLabel()">
  @if (label) {
    <mat-label [class.disabled]="isDisabled()">{{ label }}</mat-label>
  }
  <mat-chip-grid #chipGrid class="w-100">
    @for(item of control.value; track item) {
      <mat-chip-row (removed)="remove(item)" color="primary" highlighted>
        {{ labelProperty ? item[labelProperty] : item}}
        <button matChipRemove [attr.aria-label]="(labelProperty ? item[labelProperty] : item) + ' eltávolítása'">
          <mat-icon>cancel</mat-icon>
        </button>
      </mat-chip-row>
    }
    <input #inputElement
           matInput
           [placeholder]="placeholder || label"
           [matAutocomplete]="auto"
           (input)="filter()"
           [attr.aria-placeholder]="ariaPlaceholder() || placeholder"
           [attr.aria-label]="ariaLabel() || label"
           [attr.aria-describedby]="ariaDescribedBy()"
           [attr.aria-description]="ariaDescription()"
           [matChipInputFor]="chipGrid"
           [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
           (matChipInputTokenEnd)="!labelProperty && add($event)"/>
    <mat-autocomplete #auto="matAutocomplete"
                      (optionSelected)="selected($event)">
      @for (filterItem of filterOptions$ | async; track filterItem) {
        <mat-option [value]="filterItem" [attr.aria-label]="labelProperty ? filterItem[labelProperty] : filterItem">
          {{labelProperty ? filterItem[labelProperty] : filterItem}}
        </mat-option>
      }
    </mat-autocomplete>
  </mat-chip-grid>
  <input #input="ngForm" [style.display]="'none'" [formControl]="control" />
  @if (control.errors?.['server']) {
    <mat-error>{{ control.errors?.['server'] }}</mat-error>
  }
  @for (errorKey of controlErrorKeys; track errorKey) {
    <mat-error>
      @if(validatorMessages()?.[errorKey]) {
        {{ validatorMessages()![errorKey] }}
      } @else if (!!validationTranslations?.[errorKey]) {
        {{ validationTranslations[errorKey] }}
      }
    </mat-error>
  }
</mat-form-field>
